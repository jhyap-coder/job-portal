{% extends "jobs/base.html" %}
{% load static %}

{% block title %}Edit Profile{% endblock %}

{% block content %}
<div class="bg-gradient-to-r from-indigo-800 to-blue-900 min-h-screen flex items-center justify-center p-4">
    <div class="mb-10 w-full max-w-4xl rounded-2xl bg-white p-10 text-gray-900 shadow-xl">

        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between mb-6 items-start">
            <h2 class="text-4xl font-bold text-blue-900 mb-4 md:mb-0">Update Profile</h2>

            <!-- Profile Image -->
            <div class="text-center">
                <img id="profilePreview"
                    src="{% if profile_form.instance.photo %}{{ profile_form.instance.photo.url }}{% else %}https://ui-avatars.com/api/?name={{ request.user.first_name }}{% endif %}"
                    class="w-32 h-32 rounded-full border-4 border-indigo-800 mx-auto mb-3 object-cover"
                >

                <!-- Hidden input -->
                <input type="file" id="id_photo" name="photo" form="profileForm" hidden onchange="previewImage(event)">

                <!-- Styled label triggers hidden input -->
                <label for="id_photo" class="cursor-pointer inline-block bg-indigo-800 text-white px-4 py-2 rounded-lg hover:bg-blue-900 transition">
                    Change Photo
                </label>
            </div>
        </div>

        <!-- FORM -->
        <form id="profileForm" method="POST" enctype="multipart/form-data" class="space-y-4">
            {% csrf_token %}

            <!-- User fields -->
            <div>
                <label class="block text-sm font-medium text-gray-700">First Name</label>
                <input type="text" name="first_name" value="{{ user_form.first_name.value|default_if_none:'' }}"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Last Name</label>
                <input type="text" name="last_name" value="{{ user_form.last_name.value|default_if_none:'' }}"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" name="email" value="{{ user_form.email.value|default_if_none:'' }}"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <!-- Profile fields -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Phone</label>
                <input type="text" name="phone" value="{{ profile_form.phone.value|default_if_none:'' }}"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Location</label>
                <input type="text" name="location" value="{{ profile_form.location.value|default_if_none:'' }}"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Bio</label>
                <textarea name="bio" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">{{ profile_form.bio.value|default_if_none:'' }}</textarea>
            </div>

            <!-- Buttons -->
            <div class="flex justify-end space-x-4 pt-6">
                <a href="{% url 'profile' %}" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">Cancel</a>
                <button type="submit" class="px-4 py-2 bg-indigo-800 text-white rounded-lg hover:bg-indigo-700">Save Changes</button>
            </div>
        </form>

    </div>
</div>

<script>
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function() {
        document.getElementById('profilePreview').src = reader.result;
    };
    reader.readAsDataURL(event.target.files[0]);
}
</script>
{% endblock %}
