{% extends 'jobs/base.html' %}

{% block title %}Jobs{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto mt-12 mb-12 px-4">
    <form method="get" class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
        <input
            type="text"
            name="q"
            placeholder="Job title or company"
            value="{{ query }}"
            class="px-4 py-2 border rounded"
        >

        <input
            type="text"
            name="location"
            placeholder="Location"
            value="{{ location }}"
            class="px-4 py-2 border rounded"
        >

        <button
            type="submit"
            class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
            Search
        </button>
    </form>
</div>

<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">

    {% for job in jobs %}
    <div class="job-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 mt-2">

        <!-- Header -->
        <div class="relative h-20 bg-gradient-to-r from-indigo-500 to-blue-600">
            <img
                class="absolute -bottom-8 left-4 w-16 h-16 rounded-full border-4 border-white dark:border-gray-800 object-cover"
                src="https://ui-avatars.com/api/?name={{ job.company_name }}&background=0D8ABC&color=fff"
                alt="{{ job.company_name }}"
            >
        </div>

        <!-- Body -->
        <div class="pt-12 px-4 pb-4">

            <div class="flex justify-between items-start">
                <div>
                    <h3 class="font-bold text-lg dark:text-white">{{ job.title }}</h3>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-300 mt-1">
                        {{ job.company_name }}
                    </p>
                </div>

                {% if job.is_active %}
                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">
                    Active
                </span>
                {% endif %}
            </div>

            <!-- Location -->
            <div class="mt-4 flex items-center text-sm text-gray-500 dark:text-gray-400">
                <span>{{ job.location }}</span>
            </div>

            <!-- Description -->
            <p class="mt-4 text-sm text-gray-600 dark:text-gray-300 line-clamp-3">
                {{ job.description }}
            </p>

            <!-- Job Type & Salary -->
            <div class="mt-4 flex items-center justify-between">
                <span class="text-sm text-gray-500 dark:text-gray-400">
                    {{ job.get_job_type_display }}
                </span>

                {% if job.salary %}
                <span class="text-sm text-gray-500 dark:text-gray-400">
                    {{ job.salary }}
                </span>
                {% endif %}
            </div>

            <!-- Footer -->
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between">
                <span class="text-sm text-gray-500 dark:text-gray-400">
                    Posted {{ job.posted_at|timesince }} ago
                </span>

                {% if not user.is_authenticated %}
                    <a href="{% url 'login' %}" class="text-indigo-600 font-medium">
                        Login to apply
                    </a>

                {% elif job.id in applied_jobs %}
                    <span class="text-green-600 font-semibold">
                        Applied
                    </span>

                {% elif user.is_staff or user.is_superuser %}
        <a href="{% url 'edit_job' job.id %}"
           class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">
            Edit
        </a>

                {% else %}
                    <a href="{% url 'apply_job' job.id %}"
                       class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
                        Apply
                    </a>
                {% endif %}

            </div>

        </div>
    </div>

    {% empty %}
    <p class="text-gray-600">
        {% if query or location %}
            No jobs match your search.
        {% else %}
            No jobs available.
        {% endif %}
    </p>
    {% endfor %}

</div>
{% endblock %}
